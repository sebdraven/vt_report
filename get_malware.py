import argparse
import boto3
import json

class downloader:

    def __init__(self,name_bucket='sorel-20m',path='config.json'):
        self.config = json.load(open(path))
        self.access_key =  self.config['access_key']
        self.secret_key = self.config['secret_key']
        self.name_bucket = name_bucket
        self.path_binaries = self.config['path_binaries']
        self.path_direrctory = self.config['path_data']
    
    def download_malware(self,hash_file):
        
        # Créer une session AWS
        session = boto3.Session(
            aws_access_key_id=self.access_key,
            aws_secret_access_key=self.secret_key
        )

        # Créer un client S3
        s3 = session.client('s3')

        # Spécifier le nom du bucket S3 et le nom du fichier à télécharger
        
        key = f'{self.path_binaries}/{hash_file}'

        # Télécharger le fichier
        print(key)
        s3.download_file(self.name_bucket, key, hash_file)

def parse_args():
    args = argparse.ArgumentParser()
    args.add_argument('--hash_file', dest='hash_file', help='hash file')
    return args.parse_args()

if __name__ == '__main__':
    args = parse_args()

    downloader().download_malware(args.hash_file)    